{"version":3,"names":["_helperPluginUtils","require","_core","_default","exports","default","declare","api","assertVersion","TOP_LEVEL_USING","Map","isUsingDeclaration","node","t","isVariableDeclaration","kind","has","transformUsingDeclarationsVisitor","ForOfStatement","path","left","id","declarations","tmpId","scope","generateUidIdentifierBasedOnNode","ensureBlock","body","unshift","variableDeclaration","variableDeclarator","cloneNode","BlockStatement|StaticBlock","state","availableHelper","ctx","needsAwait","generateUidIdentifier","isAwaitUsing","get","delete","decl","init","callExpression","memberExpression","identifier","disposeCall","replacement","template","statement","ast","addHelper","awaitExpression","inherits","parentPath","isFunction","isTryStatement","isCatchClause","replaceWith","blockStatement","isStaticBlock","stackId","forEach","args","push","booleanLiteral","errorId","hasErrorId","block","SwitchStatement","cases","c","stmt","consequent","traverse","VariableDeclaration","buildCodeFrameError","transformUsingDeclarationsVisitorSkipFn","visitors","merge","Function","skip","name","manipulateOptions","_","p","plugins","visitor","Program","clear","sourceType","some","innerBlockBody","isFunctionDeclaration","isImportDeclaration","shouldRemove","isExportDefaultDeclaration","declaration","varId","isClassDeclaration","toExpression","isExpression","exportNamedDeclaration","exportSpecifier","isExportNamedDeclaration","Object","keys","getOuterBindingIdentifiers","map","isExportDeclaration","set","remove","pushContainer","async"],"sources":["../src/index.ts"],"sourcesContent":["import { declare } from \"@babel/helper-plugin-utils\";\nimport { types as t, template, traverse } from \"@babel/core\";\nimport type { NodePath, Visitor, PluginPass } from \"@babel/core\";\n\nconst enum USING_KIND {\n  NORMAL,\n  AWAIT,\n}\n\nexport default declare(api => {\n  api.assertVersion(REQUIRED_VERSION(\"^7.22.0\"));\n\n  const TOP_LEVEL_USING = new Map<t.Node, USING_KIND>();\n\n  function isUsingDeclaration(node: t.Node): node is t.VariableDeclaration {\n    if (!t.isVariableDeclaration(node)) return false;\n    return (\n      node.kind === \"using\" ||\n      node.kind === \"await using\" ||\n      TOP_LEVEL_USING.has(node)\n    );\n  }\n\n  const transformUsingDeclarationsVisitor: Visitor<PluginPass> = {\n    ForOfStatement(path: NodePath<t.ForOfStatement>) {\n      const { left } = path.node;\n      if (!isUsingDeclaration(left)) return;\n\n      const { id } = left.declarations[0];\n      const tmpId = path.scope.generateUidIdentifierBasedOnNode(id);\n      left.declarations[0].id = tmpId;\n      left.kind = \"const\";\n\n      path.ensureBlock();\n      path.node.body.body.unshift(\n        t.variableDeclaration(\"using\", [\n          t.variableDeclarator(id, t.cloneNode(tmpId)),\n        ]),\n      );\n    },\n    \"BlockStatement|StaticBlock\"(\n      path: NodePath<t.BlockStatement | t.StaticBlock>,\n      state,\n    ) {\n      if (process.env.BABEL_8_BREAKING || state.availableHelper(\"usingCtx\")) {\n        let ctx: t.Identifier | null = null;\n        let needsAwait = false;\n\n        for (const node of path.node.body) {\n          if (!isUsingDeclaration(node)) continue;\n          ctx ??= path.scope.generateUidIdentifier(\"usingCtx\");\n          const isAwaitUsing =\n            node.kind === \"await using\" ||\n            TOP_LEVEL_USING.get(node) === USING_KIND.AWAIT;\n          needsAwait ||= isAwaitUsing;\n\n          if (!TOP_LEVEL_USING.delete(node)) {\n            node.kind = \"const\";\n          }\n          for (const decl of node.declarations) {\n            decl.init = t.callExpression(\n              t.memberExpression(\n                t.cloneNode(ctx),\n                isAwaitUsing ? t.identifier(\"a\") : t.identifier(\"u\"),\n              ),\n              [decl.init],\n            );\n          }\n        }\n        if (!ctx) return;\n\n        const disposeCall = t.callExpression(\n          t.memberExpression(t.cloneNode(ctx), t.identifier(\"d\")),\n          [],\n        );\n\n        const replacement = template.statement.ast`\n        try {\n          var ${t.cloneNode(ctx)} = ${state.addHelper(\"usingCtx\")}();\n          ${path.node.body}\n        } catch (_) {\n          ${t.cloneNode(ctx)}.e = _;\n        } finally {\n          ${needsAwait ? t.awaitExpression(disposeCall) : disposeCall}\n        }\n      ` as t.TryStatement;\n\n        t.inherits(replacement, path.node);\n\n        const { parentPath } = path;\n        if (\n          parentPath.isFunction() ||\n          parentPath.isTryStatement() ||\n          parentPath.isCatchClause()\n        ) {\n          path.replaceWith(t.blockStatement([replacement]));\n        } else if (path.isStaticBlock()) {\n          path.node.body = [replacement];\n        } else {\n          path.replaceWith(replacement);\n        }\n      } else {\n        let stackId: t.Identifier | null = null;\n        let needsAwait = false;\n\n        for (const node of path.node.body) {\n          if (!isUsingDeclaration(node)) continue;\n          stackId ??= path.scope.generateUidIdentifier(\"stack\");\n          const isAwaitUsing =\n            node.kind === \"await using\" ||\n            TOP_LEVEL_USING.get(node) === USING_KIND.AWAIT;\n          needsAwait ||= isAwaitUsing;\n\n          if (!TOP_LEVEL_USING.delete(node)) {\n            node.kind = \"const\";\n          }\n          node.declarations.forEach(decl => {\n            const args = [t.cloneNode(stackId), decl.init];\n            if (isAwaitUsing) args.push(t.booleanLiteral(true));\n            decl.init = t.callExpression(state.addHelper(\"using\"), args);\n          });\n        }\n        if (!stackId) return;\n\n        const errorId = path.scope.generateUidIdentifier(\"error\");\n        const hasErrorId = path.scope.generateUidIdentifier(\"hasError\");\n\n        let disposeCall: t.Expression = t.callExpression(\n          state.addHelper(\"dispose\"),\n          [t.cloneNode(stackId), t.cloneNode(errorId), t.cloneNode(hasErrorId)],\n        );\n        if (needsAwait) disposeCall = t.awaitExpression(disposeCall);\n\n        const replacement = template.statement.ast`\n        try {\n          var ${stackId} = [];\n          ${path.node.body}\n        } catch (_) {\n          var ${errorId} = _;\n          var ${hasErrorId} = true;\n        } finally {\n          ${disposeCall}\n        }\n      ` as t.TryStatement;\n\n        t.inherits(replacement.block, path.node);\n\n        const { parentPath } = path;\n        if (\n          parentPath.isFunction() ||\n          parentPath.isTryStatement() ||\n          parentPath.isCatchClause()\n        ) {\n          path.replaceWith(t.blockStatement([replacement]));\n        } else if (path.isStaticBlock()) {\n          path.node.body = [replacement];\n        } else {\n          path.replaceWith(replacement);\n        }\n      }\n    },\n    SwitchStatement(path, state) {\n      let ctx: t.Identifier | null = null;\n      let needsAwait = false;\n\n      const { cases } = path.node;\n      for (const c of cases) {\n        for (const stmt of c.consequent) {\n          if (isUsingDeclaration(stmt)) {\n            if (\n              !process.env.BABEL_8_BREAKING &&\n              !state.availableHelper(\"usingCtx\")\n            ) {\n              path.traverse({\n                VariableDeclaration(path) {\n                  const { node } = path;\n                  if (!isUsingDeclaration(node)) return;\n                  throw path.buildCodeFrameError(\n                    \"`using` declarations inside `switch` statements are not supported by your current `@babel/core` version, please update to a more recent one\",\n                  );\n                },\n              });\n            }\n\n            ctx ??= path.scope.generateUidIdentifier(\"usingCtx\");\n\n            const isAwaitUsing = stmt.kind === \"await using\";\n            needsAwait ||= isAwaitUsing;\n\n            stmt.kind = \"const\";\n            for (const decl of stmt.declarations) {\n              decl.init = t.callExpression(\n                t.memberExpression(\n                  t.cloneNode(ctx),\n                  isAwaitUsing ? t.identifier(\"a\") : t.identifier(\"u\"),\n                ),\n                [decl.init],\n              );\n            }\n          }\n        }\n      }\n      if (!ctx) return;\n\n      const disposeCall = t.callExpression(\n        t.memberExpression(t.cloneNode(ctx), t.identifier(\"d\")),\n        [],\n      );\n\n      const replacement = template.statement.ast`\n        try {\n          var ${t.cloneNode(ctx)} = ${state.addHelper(\"usingCtx\")}();\n          ${path.node}\n        } catch (_) {\n          ${t.cloneNode(ctx)}.e = _;\n        } finally {\n          ${needsAwait ? t.awaitExpression(disposeCall) : disposeCall}\n        }\n      ` as t.TryStatement;\n\n      t.inherits(replacement, path.node);\n\n      path.replaceWith(replacement);\n    },\n  };\n\n  const transformUsingDeclarationsVisitorSkipFn: Visitor<PluginPass> =\n    traverse.visitors.merge([\n      transformUsingDeclarationsVisitor,\n      {\n        Function(path) {\n          path.skip();\n        },\n      },\n    ]);\n\n  return {\n    name: \"proposal-explicit-resource-management\",\n    manipulateOptions: (_, p) => p.plugins.push(\"explicitResourceManagement\"),\n\n    visitor: traverse.visitors.merge([\n      transformUsingDeclarationsVisitor,\n      {\n        // To transform top-level using declarations, we must wrap the\n        // module body in a block after hoisting all the exports and imports.\n        // This might cause some variables to be `undefined` rather than TDZ.\n        Program(path) {\n          TOP_LEVEL_USING.clear();\n\n          if (path.node.sourceType !== \"module\") return;\n          if (!path.node.body.some(isUsingDeclaration)) return;\n\n          const innerBlockBody = [];\n          for (const stmt of path.get(\"body\")) {\n            if (stmt.isFunctionDeclaration() || stmt.isImportDeclaration()) {\n              continue;\n            }\n\n            let node: t.Statement | t.Declaration = stmt.node;\n            let shouldRemove = true;\n\n            if (stmt.isExportDefaultDeclaration()) {\n              let { declaration } = stmt.node;\n              let varId;\n              if (t.isClassDeclaration(declaration)) {\n                varId = declaration.id;\n                declaration.id = null;\n                declaration = t.toExpression(declaration);\n              } else if (!t.isExpression(declaration)) {\n                continue;\n              }\n\n              varId ??= path.scope.generateUidIdentifier(\"_default\");\n              innerBlockBody.push(\n                t.variableDeclaration(\"var\", [\n                  t.variableDeclarator(varId, declaration),\n                ]),\n              );\n              stmt.replaceWith(\n                t.exportNamedDeclaration(null, [\n                  t.exportSpecifier(\n                    t.cloneNode(varId),\n                    t.identifier(\"default\"),\n                  ),\n                ]),\n              );\n              continue;\n            }\n\n            if (stmt.isExportNamedDeclaration()) {\n              node = stmt.node.declaration;\n              if (!node || t.isFunction(node)) continue;\n\n              stmt.replaceWith(\n                t.exportNamedDeclaration(\n                  null,\n                  Object.keys(t.getOuterBindingIdentifiers(node, false)).map(\n                    id => t.exportSpecifier(t.identifier(id), t.identifier(id)),\n                  ),\n                ),\n              );\n              shouldRemove = false;\n            } else if (stmt.isExportDeclaration()) {\n              continue;\n            }\n\n            if (t.isClassDeclaration(node)) {\n              const { id } = node;\n              node.id = null;\n              innerBlockBody.push(\n                t.variableDeclaration(\"var\", [\n                  t.variableDeclarator(id, t.toExpression(node)),\n                ]),\n              );\n            } else if (t.isVariableDeclaration(node)) {\n              if (node.kind === \"using\") {\n                TOP_LEVEL_USING.set(stmt.node, USING_KIND.NORMAL);\n              } else if (node.kind === \"await using\") {\n                TOP_LEVEL_USING.set(stmt.node, USING_KIND.AWAIT);\n              }\n              node.kind = \"var\";\n              innerBlockBody.push(node);\n            } else {\n              innerBlockBody.push(stmt.node);\n            }\n\n            if (shouldRemove) stmt.remove();\n          }\n\n          path.pushContainer(\"body\", t.blockStatement(innerBlockBody));\n        },\n        // We must transform `await using` in async functions before that\n        // async-to-generator will transform `await` expressions into `yield`\n        Function(path, state) {\n          if (path.node.async) {\n            path.traverse(transformUsingDeclarationsVisitorSkipFn, state);\n          }\n        },\n      },\n    ]),\n  };\n});\n"],"mappings":"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","ignoreList":[]}